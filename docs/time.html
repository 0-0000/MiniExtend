<!-- converted -->
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>MiniExtend Time</title>
<link rel="stylesheet" type="text/css" href="./css/markdown.css" />
</head>
<body class='markdown-preview' data-use-github-style><h1 id="miniextend-time">MiniExtend Time</h1>
<p>对应源文件： <em>time.lua</em>  </p>
<h2 id="code-stylecolorgreentimecode-作用域"><code style="color: green; font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time</code> 作用域</h2>
<h3 id="gettick-函数"><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">getTick()</code> 函数</h3>
<ul>
<li>函数返回当前是第几<a href="./document.html#%E6%B8%B8%E6%88%8F%E5%B8%A7">游戏帧</a>。  </li>
<li>只要你立即游戏帧的含义，该函数很容易理解。  </li>
</ul>
<h3 id="schedulecallticks-func--函数"><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">scheduleCall(ticks, func, ...)</code> 函数</h3>
<ul>
<li>在 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ticks</code> 游戏帧后以 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">...</code> 为参数调用函数 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">func</code> 。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ticks</code> 类型为 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">number</code> 的正整数，会被设置为 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">math.max(math.floor(ticks), 1)</code> 来修正不合法的数值。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">func</code> 类型为 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">function</code> ， MiniExtend 会检查它和 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ticks</code> 的类型。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">...</code> 类型不限，作为调用 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">func</code> 时传递的实参。  </li>
<li>函数不使用多线程，在当前线程执行 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">func</code> ，这可能导致程序阻塞。  </li>
</ul>
<h3 id="nexttickfunc--函数"><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nextTick(func, ...)</code> 函数</h3>
<ul>
<li>在下一帧以 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">...</code> 为参数调用函数 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">func</code> 。  </li>
<li>等价于 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">scheduleCall(1, func, ...);</code> 。  </li>
</ul>
<p>注: 如果在延时函数中调用新的延时函数，则新的延时函数从下一帧开始倒计时。  </p>
<h2 id="timetimer-类"><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time.Timer</code> 类</h2>
<p><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time.Timer</code> 表示计时器，一个 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time.Timer</code> 类表示一个计时器，以下简称 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Timer</code> 。<br>注意，计时器运行时期晚于延时调用(<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">scheduleCall()</code>)，在延时调用中启动计时器会使计时器在那一帧运行。  </p>
<h3 id="构造函数">构造函数</h3>
<p>使用 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time.Timer:new()</code> 来构造一个计时器和相应的 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Timer</code> 对象，计时器默认是<strong>暂停</strong>的。</p>
<h3 id="析构函数">析构函数</h3>
<p>使用 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Time.Timer:delete()</code> 来删除计时器，这不会删除对象本身。  </p>
<h3 id="属性">属性</h3>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">createTime</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">number</code> 类型，表示对象创建时的 <strong>CPU 时间</strong>。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">tick</code>: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">number</code> 类型，表示对象创建以来计时器<strong>运行</strong>的游戏帧数。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">callback</code>: 有则为 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">function</code> 类型，如果计时器启动，每帧都调用该函数。  <blockquote>
<p>回调时传递两个参数: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">self</code> 和 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">tick</code> 。<br><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">self</code> 表示计时器对象。<br><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">tick</code> 表示当前游戏帧。  </p>
</blockquote>
</li>
</ul>
<h3 id="方法">方法</h3>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">start()</code>: 启动计时器，如果计时器之前是暂停的返回 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">true</code> ，否则返回 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">false</code> 。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">pause()</code>: 暂停计时器，如果计时器之前是启动的返回 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">true</code> ，否则返回 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">false</code> 。  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">isRunning()</code>: 返回计时器是否启动。  </li>
</ul>
<h2 id="综合实例">综合实例</h2>
<p>每一帧都在日志输出当前帧，从第 1 帧开始，额外输出 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Fibonacci[tick+1]</code> 的值。<br>其中 <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">tick</code> 表示当前是第几帧。<br>从第 50 帧之后，停止输出。<br><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Fibonacci</code>    表示斐波那契数列，它的定义如下:  </p>
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Fibonacci[0] = 0</code>  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Fibonacci[1] = 1</code>  </li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Fibonacci[i] = Fibonacci[i-1] + Fibonacci[i-2] (i≥2, i∈N*)</code>  </li>
</ul>
<p><img alt="代码" src=".\img\code4.png"></p>
<p>timer = Time.Timer:new()  </p>
<p>-- fib1 表示 Fibonacci[tick-1] , fib2 表示 Fibonacci[tick]<br>-- Fibonacci[0] = 0, Fibonacci[1] = 1<br>local fib1, fib2 = 0, 1<br>timer.callback = function(self, tick)<br>    -- fib3 表示 Fibonacci[tick+1]<br>    local fib3 = fib1 + fib2<br>    Console:log("tick "..tostring(tick), "Fibonacci[tick+1] = "..tostring(fib3))<br>    fib1, fib2 = fib2, fib3<br>end  </p>
<p>Time:nextTick(function()<br>    timer:start()<br>    Time:scheduleCall(50, function()<br>        timer:pause()<br>    end)<br>end)<br>Console:log("tick "..tostring(Time:getTick()))  </p>
<p><img alt="部分输出" src=".\img\code4-output.png"></p></body>
</html>
